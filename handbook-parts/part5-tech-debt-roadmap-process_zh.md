## 技术债务

旧金山的金门大桥由钢铁制成,实际上颜色并不是金色的。这座桥是被涂成那种颜色的,对旧金山人来说,保持这座桥标志性的颜色是如此重要,以至于他们持续不断地粉刷它(ctohb.com/painting)。一旦重新粉刷完成,这个过程会立即重新开始。这种形式的持续投资或永久维护,正是保持最重要和最复杂的系统按预期运行所需要的,从金门大桥到您团队的软件项目都是如此。只不过对于您的项目来说,维护不需要油漆桶;它以技术债务的形式出现。

软件开发团队交付的每个功能都会带来一定程度的未来工作需求,或者说债务。该债务可以采取需要修复的错误、为交付增量客户价值而对功能进行的快速跟进,或者应该修复以提高可维护性、性能或安全性的代码草率性等形式。即使您的团队在度假,也会自然产生一定数量的债务:发现依赖软件中的安全漏洞、软件包过时、发布工具的新版本、弃用或更改第三方API等。债务是不可避免的,您需要对此负责。

### 技术债务与产品生命周期

思考技术债务的另一种方式是将其比作金融债务,比如房屋抵押贷款。当您申请抵押贷款购买房屋时,您正在做出一个深思熟虑的决定来承担债务,知道后果(利息),以使您能够做您现在想做的事情(得到一所房子)。然后您在较长时间内(每月付款)持续偿还该债务。

技术债务也是如此。您的初创公司可能会故意积累它,作为有意识权衡的一部分,而该权衡的一部分是建立一个切实可行的偿还计划。您应该将您用于偿还金融债务的同样逻辑应用于解决技术债务:要么因为您有额外的资源(并且没有更好的地方投入这些资源)而预先偿还它,要么随着时间的推移持续偿还它,或者在未来一次性偿还所有债务,但可能以包括利息在内的更高总价。

无论您选择如何偿还技术债务,成功做到这一点的关键是认识到债务是软件工程过程不可避免的一部分,主动偿还债务是对整体工程健康的必要投资。

#### 定义技术债务

定义技术债务的另一种方式是将其定义为一种技术决策、实现或细微差别,它主动降低了当今或未来业务的效率或有效性。关键是技术债务有重要的后果。您的某些代码可能客观上是丑陋或低效的,但如果这种低效对业务没有影响,并且将来不需要修改该代码来维护质量、性能或迭代,那么该代码在技术债务方面就不昂贵。毕竟,软件开发的目标,特别是在初创公司,不是编写完美的代码库,而是构建能够支持业务的软件。

不要害怕债务。它可以起到作用。例如,在构建尚未在市场上得到验证的产品的第1版时,技术团队可能会决定采用一种无法扩展超过一百个用户的架构。如果该决定允许团队快速验证产品并确定是否有一百个用户会使用该产品,那么该路径可能是值得的——特别是考虑到可能需要这些原型的几个版本才能找到用户喜欢的版本。

至少有七种类型的技术债务:

1. **架构**或**设计债务**在软件设计无法满足业务的近期或未来需求时产生。例如,设计使构建业务所需的功能过于具有挑战性,或者设计无法扩展到业务的用户数量或性能要求。
1. **代码债务**在实现本身没有注意最佳实践时产生,产生难以理解和维护的代码。
1. **测试债务**在您运行的自动化测试不足以为团队提供对代码库正确性的信心时积累。
1. **基础设施债务**在基础设施、可观察性和支持系统不够健壮或维护不善时发生,导致难以扩展或部署更新,或正常运行时间和可靠性差。
1. **文档债务**在文档不足或文档陈旧/不准确时产生,这可能使团队成员难以加入项目。
1. **技能债务**在团队成员缺乏维护或更新代码或周围基础设施所需的技能时产生。
1. **流程债务**在团队解决问题的方式不一致时积累,导致错误、延误或成本增加。

#### 技术债务破产

如果您的初创公司长时间忽视或忽略技术债务,它可能成为未来进展的主要障碍。团队可能会无意中发现自己将80%甚至100%的时间花在整理系统问题或由技术债务导致的低效率上,这种状态被称为技术债务破产。

您的团队可能处于技术债务破产的一些迹象:

* 您经常处理生产中断,达到了重大业务影响的程度。
* 由于需要处理债务,您不断收到对新功能的阻力或夸大的时间表。
* 团队抱怨代码库过于复杂,无法完成工作。
* 新功能无法在不意外破坏旧功能或引入不可接受的高缺陷水平的情况下发布。

如果您发现自己处于技术债务破产状态,是时候敲响警钟,与利益相关者重新设定期望,制定整合债务的计划,并立即开始偿还债务。

如果您一直对领导层的同行诚实(请参阅第46页的"传达坏消息"),您应该具有必要的可信度来解释技术债务问题,并对解决技术债务投资的投资回报率建立共同的理解。

#### 衡量债务——债务清单

与抵押贷款或汽车贷款不同,没有网站可以访问,它会给您一份您确切的技术债务金额和剩余付款的声明。某些形式的债务可以定量衡量,但大多数分析是定性的。为了在规模上进行健康和负责任的债务管理,我建议进行债务清单调查。

调查应该定期进行。每年一到四次,对各种类型的债务进行清醒的分析,对团队的运营情况进行诚实的评估。不要独立进行调查;相反,与团队中每天在代码中工作并定期与债务互动的其他工程师合作进行。

调查可以像这样简单:对于以下每种类型的债务,以1到10的比例评估我们有多少,然后提供几句话来证明分数的合理性。

使用调查结果来告知您的团队如何花费精力偿还债务,并随着时间的推移比较调查结果,以确保债务保持在合理的水平,您的团队定期解决其最大的债务痛点。

#### 偿还债务的策略

为了决定何时偿还技术债务,您应该首先考虑值得花费团队多少时间在上面。关键考虑因素包括:

* 存在多少债务,如您最近的债务清单调查所示
* 它在多大程度上阻碍了公司日常运营的能力,即通过中断、客户流失或缺陷率
* 它在多大程度上损害了团队交付新项目的能力 偿还债务的难度有多大

如果您没有处于技术债务破产状态,并且您的目标是保持健康的债务水平,我建议将团队时间的10-20%分配给非功能工程的投资(例如,偿还债务、探索新模式/概念证明、改善开发人员体验等)。您当前债务影响越严重,偿还债务所需的努力越高,您应该分配的团队时间百分比就越高。

##### 即时付款

处理技术债务的最常见方法是以即时方式偿还它,这意味着债务作为业务驱动项目的一部分偿还。这通常看起来像团队在规划会议中添加与为冲刺选择的故事相关的技术债务票。这是一种低开销和低规划工作的方法,它可以很好地工作。但要注意一些潜在的陷阱:

* 即时付款,由于对更广泛的团队不太可见,可能导致技术债务的系统性投资不足。确保在进行即时付款时对团队诚实和透明,说明您期望团队时间的总百分比是多少。

* 将技术债务作为冲刺的一部分添加可能意味着投资技术债务是冲刺目标的次要目标,因此如果团队时间不足,可能会从范围中删除。

* 在冲刺中处理技术债务可能被认为是减慢冲刺或导致延迟,而不是对速度和整体系统健康的投资。

##### 定期偿还

定期偿还类似于人们如何偿还汽车贷款或抵押贷款。团队以固定间隔(例如,每个冲刺一天,每月几天,或每季度几周)腾出空间来偿还债务。谷歌著名地允许他们的工程师20%的时间来做他们想做的任何事情,包括偿还债务或创新新项目和工具。这里的想法是一样的:作为经理,您明确腾出时间并鼓励团队对用于进行工程的工具和流程进行投资。

例如,Shape Up方法(请参阅第157页的技术流程)描述了在六周周期后的两周冷却期,或八周期间的25%,用于进行技术投资。请记住,25%不是一个神奇的数字;正确的百分比将取决于您团队的债务清单。

#### 持续偿还

根据债务对您的团队有多昂贵,您可能希望将更多资源投入到整体系统质量上,而不是定期策略允许的。这看起来像有一个专门的团队——我在双船员场景中称之为客户船员(请参阅第113页的项目维护:双船员哲学)——作为日常工作和目标的一部分偿还技术债务。

重要的是要确保任何主要目标是内部效率的团队,例如技术债务团队或客户船员,对其工作有明确和可衡量的目标。例如,如果您的债务清单将测试债务列为您最高的债务类别,那么衡量缺陷率和代码覆盖率,并让客户船员对改善这些指标负责。如果您的基础设施债务最大,那么专注于正常运行时间和平均恢复时间指标。

### 技术债务的沟通

非技术领导者不期望技术团队完美。但他们确实期望高性能和持续满足期望。

在债务方面,这意味着清楚地沟通您将债务保持在可管理水平的策略,并且还提供关于债务何时可能妨碍业务目标的预先和诚实的沟通,以及您偿还债务的策略,使其不再是阻碍。

## 技术路线图

### 时间框架

我发现将技术路线图分为三个时间框架很有用,有时标记为短期、中期和长期,或地平线一、二和三。每个时间框架应该由不同的流程管理,通常由不同的利益相关者拥有。


#### 短期/地平线一

您的短期路线图是您的团队现在正在做的事情。这包括任何进行中的功能、正在积极处理的缺陷、技术债务或紧急工作项。有关管理短期路线图的更多详细信息,请参阅第157页技术流程部分的工作流程。


#### 中期/地平线二

如果您是团队中唯一的技术经理,那么您负责中期和长期路线图。如果您有向您报告的总监或高级经理,您可能会在中期路线图上进行协作。中期路线图是一个非常有用的工件,不仅用于您自己的规划和组织,而且还作为与其他部门/利益相关者沟通工程团队正在做什么的工具。

通常,中期路线图作为电子表格实现,其中团队或个人是行,列是时间段——通常是周或冲刺——表的内容是高级工作项或工作领域。路线图的目的不是精确预测任何给定任务何时完成;这样做需要准确和精确的工作估计,这在最好的情况下是脆弱的(即使在几周的粒度上),也从来不是保证。相反,想法是概述操作顺序并为团队设定方向。

随着工程的进展,您可以并且应该期望更新任何给定活动的实际持续时间。更新给定任务的周数是一个很好的时间点,可以评估继续投资项目是否有意义,并向外部利益相关者更新当前完成估计。最后,路线图作为回顾工具有助于跟踪主要计划花了多长时间,还可以在非常高的级别评估团队在哪里投资时间。

#### 长期/地平线三

作为团队的领导者,您有责任关注团队的长期健康和生产力。您应该花时间设计这些目标,并制作一个深思熟虑的、清晰的文档(或幻灯片、视频、维基文章等),向团队解释目标。一旦您设定了初始目标,就不要频繁地重新审视它们,因为改变战略目标会在组织中造成流失。同样成问题的是,频繁的方向变化可能会让团队感到困惑和沮丧。我鼓励您每季度向整个工程团队以及其他执行领导者提供长期计划进展的更新。

长期计划的一些例子:

*架构技术债务*

- 从弃用的框架迁移到主动维护的框架
- 从一个托管环境迁移到另一个(例如,加入Kubernetes)

*语言债务*

- 整合编程语言的使用
- 从旧版本的语言迁移到新版本(Python 2到3,或.NET 4到.NET 5+)

*平台/架构采用*

- 让多个团队采用或迁移到内部服务的新版本
- 迁移到/从无服务器环境
- 采用新范式(例如,服务器端渲染、边缘计算)

*招聘计划*

- 扩大或重组团队
- 招聘专家或建立新的技术部门

#### 时间表沟通

我与之合作的销售、营销、产品或支持部门的每一位领导者都对技术流程和技术路线图的透明度表示赞赏。相比之下,我与一些公司的领导者交谈,他们将技术团队描述为黑洞。不用说,您不想被称为黑洞。不成为黑洞很简单;它看起来像您组织中的某个地方有一个定期流程,为其他领导者提供透明度。理想情况下,您还通过有一个论坛或机制来接受输入并将其纳入路线图流程,帮助其他部门感到被倾听。您可以并且应该通过在流程中与利益相关者沟通他们的请求在开发流程中的位置,并管理何时完成的期望,来与其他部门关闭循环。
## 技术流程

康威定律指出,"设计系统的组织,受约束只能生产这些设计,这些设计是这些组织的沟通结构的副本。"换句话说,您如何构建团队,重要的是这些团队内部和之间的工作流程,将对您制作的产品产生重大影响。在信息孤岛中工作的团队不太可能生产出与另一个团队的设计完美集成的产品,因此作为这些沟通结构的监督者和最终架构师,您有责任确保这些结构满足您正在开发的产品的需求。

### 工作流程

技术工作是一个高度细致的问题,有数千个微小的决策将影响事物最终如何互操作和行为。要对在组织内保持生产力有任何希望,您需要一套标准和指导原则,以确保日常技术决策大致一致,从而对团队来说是可管理的。这意味着您需要实际设定这些标准,对团队进行培训,并有一个日常流程来在必要时执行和修改它们。

团队遵循的模式,以确定如何决定构建什么以及如何完成工作,被称为工作流程。五种最流行的工作流程模式是:

* 敏捷(Agile)
* SCRUM
* 看板(Kanban)
* 瀑布(Waterfall)
* Shape Up

有关于这些模式的整本书,我最喜欢的是杰夫·萨瑟兰(Jeff Sutherland)的《Scrum:用一半的时间做两倍的工作》。

这些方法有一些基本的优势和劣势,我将在本章中讨论;然而,在现实世界中,流程之间的差异被经理实施所选流程的好坏的影响所掩盖。作为技术领导者,您的工作是选择一个流程并确保它得到很好的实施和迭代。

一个好的开发流程尊重以下关于软件开发的真理:

* 没有人能够完美预测完成任何给定工程任务需要多长时间。
* 工程很少是一条直线;构建功能X可能需要在构建X之前将时间投入到问题Y。
* 没有完美的规范这种东西;在构建技术的过程中,总是有差距和要发现的东西。

一般来说,工作流程流程的目标是确保团队组织良好并以可接受的速度交付。以一种迂回的方式,一些工作流程流程甚至试图量化工程团队速度,允许向非技术利益相关者报告速度如何随时间变化。

#### 瀑布

最古老的工作流程流程,可追溯到1950年代,是瀑布(请参阅ctohb.com/waterfall)。瀑布模型将项目活动分解为顺序步骤,其中每个步骤依赖于前一个步骤并在前一个步骤完成后开始。在软件工程中,这看起来像首先有一个产品愿景,然后进行产品概念化,然后产品设计,然后软件开发,最后测试、部署和维护。对瀑布的最常见批评是这种结构是僵化的、不灵活的,并且不促进迭代开发。

#### 敏捷/Scrum

敏捷和SCRUM流程是一种比瀑布更细致和更规范的方法论。有许多很棒的资源详细涵盖了这些细微差别,包括萨瑟兰的《Scrum》、迈克·科恩(Mike Cohn)的《敏捷估算和规划》、詹姆斯·肖尔(James Shore)和沙恩·沃德斯(Shane Warders)的《敏捷开发的艺术》。

关于这些流程要意识到的关键是,它们是指南,而不是圣经。要从您的工程团队中获得最好的结果,从一个流程开始,看看它对您特定的人群和您特定类型的技术挑战有多好。一些团队的工作更适合估计和故事点,而其他团队有更模糊的棕地项目,估计几乎是不可能的。注意流程中的任何特定仪式是否真的为工程团队增加了价值,或者它是否只是每个人都害怕的冗长会议。

不要犹豫跳过对团队来说不是明显胜利的仪式。例如,我发现SCRUM对规划扑克的规定对大多数团队来说都是低效的。

#### Shape Up

Shape Up是由Basecamp公司正式化的一种方法论,并以电子书的形式在basecamp.com/shapeup上发布。Shape Up的核心周期是六周长,比SCRUM提倡的冲刺要长得多。这个周期使用固定时间和可变范围。想法是更长的时间段为生成清晰的推销(规范)并在项目上做好工作提供了更多空间。Shape Up对估计的强调远远少于其他模型,正如我很快会讨论的,这对工程团队来说是一件好事。

### 工程估计

根据谷歌,准确性的技术定义是测量、计算或规范的结果符合正确值或标准的程度。也就是说,准确性是整体正确性的指标。当您向飞镖靶投掷飞镖并瞄准靶心时,一组准确的投掷是一组倾向于中心的投掷。

相比之下,精确度在技术上被定义为测量、计算或规范中的细化,特别是由给出的数字位数表示。换句话说,精确度表示精确程度。投掷飞镖时,如果您的所有投掷,无论目标如何,都紧密地分组在一起,那可以说是一个精确的分组。

正如这个描述应该帮助您可视化的,某些东西可以准确而不精确(围绕或靠近靶心但没有击中它的飞镖的广泛分组),精确而不准确(错过靶心的飞镖的紧密分组),当然,既准确又精确(击中靶心的飞镖的紧密分组)。

您应该期望并让您的团队对完成软件开发任务的准确但不一定精确的估计负责。如果今天是本月的第一天,来自您团队的合理指导是,"我们将在本月交付功能。"如果团队说,"我们将在23日交付功能",他们更有可能错过该截止日期。

如果您按周、月或季度计划工作/资源分配,则无需尝试估计每张票的小时或天数。随着时间的推移,注意您的估计是否实际上为您提供了您希望的规划能力。如果没有,不要通过继续流程来惩罚团队,或者更糟糕的是,将其用作绩效评估的贡献因素。相反,调整估计,使它们有帮助而不是伤害您。改变您的期望,而不是对错过估计做出反应,对团队在努力满足估计时面临的挑战做出反应。

关于估计的最后说明:不要将错过估计与总产出/速度差混为一谈。一些团队将非常有效,产出高,仍然错过估计。速度是更重要的指标,产出高但估计不完美的团队不应该受到惩罚。相反,经常错过估计*并且*在交付新价值方面遇到困难的团队表现不佳,需要改变。

### 燃尽图

SCRUM燃尽图显示团队相对于估计的进度,可以是衡量冲刺生产力的好工具。然而,估计是不完美的,由于各种原因,燃尽图可能显示平线甚至燃烧起来。这可能是因为团队确实没有取得进展,或者它可能是估计问题或数据收集不良的产物。

尽管团队发布并做好工作,但持续燃烧起来的燃尽图是令人沮丧的,并且没有实现预期的好处。如果有简单的调整可以帮助您更好地捕获数据并修复图表,请进行该更改。但是,如果您发现特定的输出测量方式仍然不起作用,只需摆脱它。承认您用这个团队估计这些特定类型的故事的方法不够精确并继续使用其他监控和改善性能的方法是可以的。

根据我的经验,只有一小部分团队在燃尽图方面取得成功,所以如果那一种技术对您的工程团队没有帮助,不要气馁。

### 选择工作流程

我认为,您选择哪种工作流程不会是您工程团队最终成功和速度的重要因素。关键因素是您正在关注团队的工作流程,并不断迭代工作流程本身,以确保您的模式增加价值,并且对您的团队和团队面临的问题类型都是一个很好的匹配。

也就是说,这里有一个粗略的模型来思考哪种类型的工作流程可能是一个更好的起点:理解良好的工作(即,具体、绿地且易于解释的任务)更容易管理,并将通过更细致或更规范的规划流程产生更多好处。换句话说,如果您的工作是模糊的并且难以估计,它可能更适合用看板而不是SCRUM来管理。

倾向于与SCRUM很好地工作的理解良好的故事是:

* 绿地——也就是说,不依赖于可能是遗留的或难以使用的外部模块的新代码
* 不依赖于新的模式/工具/技术,而是依赖于现有的(无聊的)技术栈
* 容易从故事分解为更小的任务 团队从以前的工作中熟悉

相反,如果您的工作是以下情况,您可能更适合看板:

* 棕地,或受技术债务严重阻碍,偿还/重构的路径不清楚
* 经常变化或受不可预测优先级的困扰
* 依赖于采用新的和不同的工具和模式,这些工具和模式可能在前几次实施中引入意外成本
* 分配给全新的团队,该团队没有一起工作或从事这些类型项目的历史

### 冷却/创新冲刺

当使用像冲刺这样的常规节奏时,团队发现自己陷入的主要危险是期望冲刺将完成,功能将发布,团队可以立即转移到下一组功能。由于债务的积累和迭代产品功能的需要,这根本不可能持续。必须有连续或定期的时间来偿还债务。

定期偿还债务的常见做法是冷却冲刺的概念。有时称为技术债务冲刺或创新冲刺,想法是一样的:给团队时间清理他们的数字工作空间,做一些代码整理,并确保他们和代码处于高速度工作的良好状态。正如在第150页的"偿还债务的策略"中讨论的,将总开发时间的5-20%用于冷却工作是合理的。

如果您正在进行两周的冲刺,这可能意味着每四到五个冲刺中就有一个专门用于冷却。

### 技术规划和规范

在与工程师讨论编写技术规范的流程时,我经常被问到,"您如何有时间编写规范?"通常我会反问,"您如何有时间*不*编写技术规范?"我的回答中暗示的是,在构建之前花时间思考您正在构建的内容是净时间节省者。

软件工程本质上是一个创造性的过程,这意味着我们不是每次都在做同样的事情,并且有不止一种方法来完成任何特定的故事。一个很好的规划流程认识到提前思考故事是有价值的,但平衡了对预先规划的强调,知道真正了解功能的一切的唯一真正方法是实际构建它。

一个很好的技术规划流程可以实现几个目标:

* 减少功能中的返工量
* 确定以更少的工作实现相同功能的方法
* 降低忘记重要的非业务可见考虑因素的机会,例如错误处理/负面案例、测试、日志记录、监控、分析、安全性、可扩展性、启动规划和技术债务偿还
* 增加来自多个人/团队的工作以兼容方式完成的机会
* 为如何以及为什么以某种方式构建功能提供有价值的文档,用于未来的维护、改进或扩展
* 让团队在不可逆/昂贵的技术考虑(例如,工具和架构)上保持深思熟虑和一致,以及不太可能忘记的关键细节
* 证明足够轻量,可以在合理的时间内完成,并且不会强制对要么不重要要么预先没有足够信息的次要细节做出决定

#### 技术规范负责人

我建议您为任何需要规划的项目指定一个负责人:一个负责生成技术规范并使该规范通过您的批准工作流程的单个人。

这并不意味着他们是唯一的贡献者。相反,如果其他团队成员在规划窗口期间可用并具有有用的知识,他们可以并且应该贡献。

规划可以是同步的(即,每个人在整个时间段都在一个房间里)或异步的。我建议异步规划,因为规划中的许多工作将涉及研究(例如,阅读产品文档、阅读代码、原型/概念证明、评估工具和API等),这些可以很好地独立完成。

#### 规划时间

您的技术规划流程应该在初始实施中为您节省时间。它还应该通过最小化技术债务并留下可以加速未来改进的文档来节省未来的时间。

投入规划的错误时间量不能满足这些目标,要么是因为它太短并且不能为您节省时间/产生好的文档,要么是如此冗长以至于它不能在节省中为自己买单。

没有通用的正确时间量公式,但我将提供一个经验法则:为您估计项目需要的每周工作分配一天进行技术规划。一般来说,这将导致半天到三天的规划窗口。如果您的项目需要不到两天的工作,它可能需要非常少的规划工作,并且风险很低。相反,如果您正在查看一个预计需要超过三个完整周的开发工作的项目,您可能无法一次有效地规划那么大的东西,应该考虑将其分解。

如果您的团队拒绝投资时间进行规划,您可能在结果上推得太紧,而不是流程。确保工程流程为业务产生良好结果的方法不是更加挥鞭,而是建立一个能够产生良好结果的健康流程。您不会通过让结构工程师设计桥梁的团队工作更长时间来加速他们。您会确保他们拥有可用的最佳桥梁设计工具以及关于被桥接跨度的最佳可能信息。软件工程没有什么不同。但是,我们拥有的不是使用CAD软件或土壤/岩石的现实世界测量,而是产品规范、设计流程和软件工具。

相反,过度冗长的规划流程,团队成员坚持预先获得每一个细节,可能是一个严重的文化问题的指标,团队成员因害怕犯错误而瘫痪。有效的规划不会消除风险,但提前思考重要的、高级别的决策可以最小化风险。对细节痴迷的团队可能害怕犯错误或不愿意迭代他们的工作——这两者都是过度结果驱动管理的症状。个人不应该因为合理的错误或规划疏忽而受到惩罚。技术规范预先不完美是可以的;期望您的团队在实施过程中发现错误或差距,并在发现这些问题时更新规范。

### 作为规范编写的一部分进行原型设计!

在编写技术规范时,您通常会有多种选择来实现目标,而在纸上没有任何明显令人信服的论据来选择一种方式或另一种方式。或者您会发现关于特定选项有效性的未知数,这使得决定模糊。如果可能的话——特别是如果可以高效地完成——我鼓励您给您的工程团队空间来原型化这些解决方案中的一个或多个,以获得数据来在规划中做出更好的决策。花半天时间用新工具构建玩具来验证该工具将预先实现所需结果,这半天花得很值得。

### 技术规范内容

当开始编写技术规范时,让您的团队使用一个模板是加速事情并确保重要主题不被忽视的好方法。我建议您的模板主要是要涵盖的主题领域的标题序列,也许为技术规范作者提供一些指导或提醒。我在(ctohb.com/templates)[https://ctohb.com/templates]上包含了一个技术规范样本。

在进入内容之前快速说明一下:技术文档可能有点枯燥和严肃。如果它符合您的文化,我鼓励您在适当且不分散注意力的地方注入轻松愉快。一个很好的例子是在文档顶部放一个引用规范主题的巧妙模因。根据我的经验,只需要一个经理/领导者在规范中制作一次模因就可以鼓励团队中的其他人(阅读:打开闸门)添加他们自己的模因。

要包括在模板中的一些建议组件:

* 提醒该文档实际上是一个模板,作者在开始编写之前应该制作副本(这个错误很容易犯!)
* 关于应该如何思考规范/对公司规范指南和批准流程的引用的指导
* 背景部分,解释项目的业务理由
* 该项目具有的任何特别突出的技术风险领域(例如,它涉及敏感的PII,或涉及以前未使用的工具/架构)
* 任何非明显术语的词汇表/定义
* 规范旨在实现的任何明确业务目标/与先前陈述的目标的相关性(即,季度KPI或OKR)
* 解决方案架构概述(文档的主体)
* 技术债务——特别讨论为什么或为什么不解决任何必需/相邻的债务
* 数据建模,包括对数据库或数据管道的必需更新
* 内部和外部报告或分析和测量要求
* 测试
* 部署
* 功能切换/标志
* 对整体系统可靠性或灾难恢复安全和隐私的影响
* 可交付里程碑

### 技术规范批准

为了实现确保项目之间和团队成员之间的一致性和对齐的目标,您必须确保团队成员正在阅读和贡献彼此的规划流程。我的建议是在规范被视为完成之前有一个轻量级的批准流程。

#### 审查目标

您的技术规范审查目标应包括以下内容:

* 确保所有团队/项目在技术方向上保持一致并一致地构建。
* 审查并教育团队重要的数据概念/技术合同。
* 确保对手头问题的普遍和一致理解。
* 最小化错过重要边缘案例或其他非业务可见要求的机会。

#### 审查流程

我对轻量级审查流程的建议是在文档中进行异步对话,然后进行同步冲突解决会议(有关冲突解决会议的更多信息,请参阅第28页的会议和时间管理)。技术规范的作者应该,一旦他们在项目的关键要素上取得了一些进展,就与其他具有足够背景的工程师传阅文档。想法是让其他人阅读文档并在自己的时间留下评论和问题。其中许多问题可以由主要作者快速和异步地解决,但有些可能是有争议的或高度细致的,需要更高带宽的沟通。

为了结束流程,作者应该安排一个会议,其参与者只是那些提前阅读文档并做出贡献的人。会议的目的是审查开放问题和冲突并达成解决方案。会议的目的不是让作者简单地向无聊或不感兴趣的观众大声朗读规范。如果有需要进一步尽职调查才能了解和解决的开放问题,那么离线进行并仅与感兴趣的各方事后审查结果。

一旦所有开放问题都得到解决,记录谁为规范做出了贡献(以便未来的读者知道应该向谁提出进一步的问题),并认为文档已获批准。

#### 规范审查会议中的领导者

技术领导者或经理不必成为所有技术文档的批准者。我鼓励您建立一个文化,团队作为一个整体感到安全可以贡献,并且不依赖您提供技术护栏或支持。在早期,当部门相对较小时,您应该深入参与大多数或所有规范,但该方法不会扩展。一旦您雇用了其他高级个人贡献者、架构师或经理,授权他们成为主要审阅者并服从他们,让他们做您雇用他们做的工作。如果您发现高级成员在这些审查中没有很好地指导团队,不要在公共论坛上踩踏他们。私下与他们讨论并纠正路线。

#### 技术规范作为文档

您的技术团队现在正在花时间创建涵盖您如何工程化产品的深思熟虑的文档,结果团队应该减少错误。技术规范帮助您的最后一种方式是为需要增强或修改已完成工作的未来工程师提供有用的资源。我建议您创建一个组织良好且可搜索的目录(例如,像Confluence或Notion这样的内部维基,或像Google Drive这样的文档存储),并且您的团队要努力确保所有规范文档都添加到目录中。在代码注释中链接或引用规范以解释为什么某些东西以这种方式实现也可能有所帮助。

## 开发人员体验(DX)

DevOps工具公司Harness(harness.io)将开发人员体验(DX)定义为开发人员在朝着目标工作时感受到的整体互动和感觉。它类似于用户体验(UX)的定义,除了在这种情况下,主要用户是软件工程师。

开发人员体验可能并不总是在仪表板上衡量,但当它设计得很差时,团队知道,他们可能会大声抱怨它。糟糕的开发人员体验可能会让工程师整个下午脱轨——例如,尝试启动微服务进行测试会引发一个神秘的回溯,而服务的维护者在度假,因此一个中级工程师在试图达到可靠的构建-执行-测试循环时白费了几个小时。

将这种低效率乘以您团队上的所有工程师以及您公司存在的所有各种类型的存储库、服务和项目,它可以迅速螺旋式上升为直接时间失去人月的生产力。加上花在引入其他人帮助解决问题的额外上下文切换时间,糟糕的DX迅速上升到当未解决时可能使原本高性能的工程团队崩溃的领域列表的顶部。

出色的开发人员体验有两个先决条件:

1. 使拥有高度可靠和可重现的环境和依赖链变得容易的工具
1. 关于如何做事的文档和实践的一致性

值得庆幸的是,如今,许多现成可用的工具和生态系统可以帮助解决#1。大多数编程语言都有一个生态系统,其中包含用于依赖管理和可重现环境的标准化工具。由您来识别和使用它们(例如,npm、pipfile等)。这些系统中的许多都会生成一个称为锁定文件的文件。

锁定文件不是用于并发管理以避免死锁;它旨在锁定依赖关系图的特定实例。您应该提交这些锁定文件,并确保其他开发人员和任何构建系统使用它们。锁定文件有助于保证团队中的每个人都安装了一组相同的依赖项。

如果您选择的编程语言不提供这些工具,那么由您来构建该可重现性——也许通过使用docker容器、makefile或类似的东西。

通常,良好DX和糟糕DX之间的差异是熟悉代码库的某人提前花费的二十或三十分钟的努力。

确保基本构建命令在全新安装中工作,并且这些命令记录在本地README中,这不需要很长时间。

作为CTO,您使这更容易的一个机会是确保您公司的存储库和代码库中使用的构建命令是一致的。也许总是`docker compose up`或总是`yarn run`。无论是什么,任何开发人员都应该能够git clone任何存储库,然后想到的第一个构建和运行软件的命令就可以工作。

### 优先考虑开发人员体验

不在产品路线图上的任何东西都可能难以优先考虑。

值得庆幸的是,DX很少需要足够大的时间投资,以至于需要在路线图上进行分类。在您公司的早期,我更喜欢遵循童子军规则——让代码库(或开发人员体验)比您发现它时更好。任何时候开发人员遇到构建、运行或测试某些东西的问题,他们有责任修复、记录或以其他方式确保接下来来到该代码的人有更容易的时间。

随着系统开始变得更大,让所有东西在本地一起运行以测试功能可能成为越来越大的苦差事。在这一点上,可能值得在路线图上更正式地投资DX,甚至用专门的人力,以确保工具工作,开发人员不会失去大块时间与系统战斗,而不是编写生产性代码。

### 简单的开发人员体验胜利

以下是在您的软件工程团队中升级DX的一些简单胜利:

* 拥有一个带有运行代码库说明的README文件——理想情况下是一个用于安装依赖项然后构建和运行代码的一行命令。
* 强制所有代码都使用一组严格的linting规则进行lint,这些规则在您公司该语言的所有使用中都是一致的。如果linting不通过,则使构建失败。如果所有开发人员都配置了他们的IDE自动lint,构建很少会因为lint问题而失败。

* 确保lint配置在可能的情况下被检入源代码控制(即,通过投资设置像VSCode的settings.json文件这样的东西,可在ctohb.com/vscode找到)。

* 投资时间确保本地测试数据可以从头开始在本地数据库中设置。通常,快速数据生成器或种子数据脚本可以短路许多开发人员的头痛。如果种子数据可以轻松增强以添加额外的角落案例/用例,随着系统的发展,使测试数据的基础集尽可能全面/代表性,那就更好了。

* 制定一个计划,说明在必要时如何模拟或实际在本地启动依赖服务,以测试多服务交互。理想情况下,通过良好的合同和领域驱动设计,对此的需求将是罕见的,尽管在必要时应该仍然很容易。

### 为开发人员体验更改工具

2022年,金融科技十角兽(即估值超过100亿美元的公司)Stripe决定,Flow,其当前的编程语言,使用起来已经变得太昂贵了。它使用了太多内存,锁定了笔记本电脑,并且与开发人员IDE集成得很差。

TypeScript,像Flow一样,是构建在JavaScript之上的可选类型语言。TypeScript的采用率远远高于Flow,因此解决了Stripe团队在Flow中遇到的许多问题,随着时间的推移,Flow变得更加痛苦。越来越清楚的是,TypeScript提供了比Flow更大的DX改进。唯一的问题是,您如何将数百万行代码从一种语言转换为另一种语言?

答案是,一个工程师团队进行了为期十八个月的项目,为一次性的、大规模的合并提交做准备,以一次性更新整个代码库。2022年3月6日星期日,Stripe的大型合并着陆,3月7日星期一,团队回来工作并开始使用新的编程语言。一位开发人员将这一变化描述为他们在Stripe期间最大的开发人员生产力提升。

这里的教训是,如果糟糕的开发人员体验的痛苦足够严重,那么几乎没有成本太高或任何项目超出范围来进行改进。您的团队几乎肯定比Stripe的小,您可能没有处理数百万行代码,但同样的计算适用:如果您的团队在DX中遇到正在减慢它的摩擦,您必须投资必要的开发人员时间和精力来改进它,以重新获得该效率。

团队经常面临的另一个问题是过于频繁地更改工具。在某些技术生态系统(特别是JavaScript世界)中,似乎每个月都会出现一些新的闪亮的东西,可以为您的团队提供生产力提升。我鼓励您对采用新工具保持纪律,确保您已经花时间真正理解存在的痛苦,对新工具进行尽职调查,看看它是否满足*所有*您的要求——不仅仅是闪亮的标题——并相应地做出决策。有关我在此处推荐的流程的更多信息,请参阅第204页的实施内部技术雷达。

# 技术架构

作为技术领导者,您的关键责任之一是就架构和工具做出良好的决策。良好的架构将您选择的工具和模式的优势与您的组织现在和可预见的未来的需求保持一致。这需要理解每个选择中固有的优势、劣势和权衡。我在本节书中的目标是让您大致了解各个领域的选项格局,并帮助您认识到不同策略所带来的一般权衡。

在与团队讨论工具和工具选择时要记住的一件事:工程师可能对工具选择充满情感。工具被评论为好和坏,人们有个人喜好、不喜欢和偏见。作为领导者和决策者,我强烈警告您在讨论工具时不要采用这种语言风格。这不仅可能疏远团队成员,如果您贬低他们个人最喜欢的工具;这也是没有生产力的,并且可能会分散为您的问题确定良好解决方案的目标的注意力。

一些个别工具确实设计得很差,并且被优越的替代品所掩盖。然而,更多时候,更细致的评估将揭示给定的工具本身并不坏,而是适合或不适合特定的公司或项目。不要让一次使用不适合解决一个问题的工具的糟糕过去经历阻止您或您的团队在另一次可能证明更适合时使用它。
